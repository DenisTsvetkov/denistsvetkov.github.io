<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8">
	<title>Экспертная система</title>
</head>
<body>
	
	<script>
		var initialModel = [
		  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0],
		  [0, 0, 0, 0, 0, 0, 0, 0, 0, 0]
		];

		var objects = {
			'0':
				{
					'name': 'Колбаса',
					'props': [0.3,0.7,0.5,0.5,0,0,1,0,0,1]
				},
			'1':
				{
					'name': 'Сыр',
					'props': [0.4,0.6,0.5,0.5,0,0,1,0,0,1]
				},
			'2':
				{
					'name': 'Хлеб',
					'props': [0,0,0.2,0.8,0,0,1,0,0,1]
				},
			'3':
				{
					'name': 'Шоколад',
					'props': [1,0,0.7,0.3,0,0,0,1,0,1]
				},
			'4':
				{
					'name': 'Газировка',
					'props': [1,0,0,0,0,1,0,1,0,1]
				},
			'5':
				{
					'name': 'Картошка фри',
					'props': [0,1,0.2,0.8,0,0,1,1,0,1]
				},
			'6':
				{
					'name': 'Чипсы',
					'props': [0,1,0,1,0,0,0,1,0,1]
				},
			'7':
				{
					'name': 'Яблоко',
					'props': [0.7,0,0.7,0.3,0.3,0,0,0,1,0]
				}
			// '8':
			// 	{
			// 		'name': 'Молоко',
			// 		'props': [0,0,0,0,0,1,0.5,0,1,0]
			// 	},
			// '9':
			// 	{
			// 		'name': 'Мёд',
			// 		'props': [1,0,0.1,0.9,0,1,1,0,1,0]
			// 	}
		}

		class ExpertModel{
			constructor(matrix, cyber_cube) {
				this.matrix = matrix;
				this.cyber_cube = cyber_cube;
			}

			getNameObject(object){
				var count = Object.keys(objects).length;
				for(var i=0; i < count; i++) {
				    if(objects[i] == object) {
				      return i;
				    }
				}
			}

			get count_object(){
				return Object.keys(objects).length;
			} 

			get count_prop(){
				return this.matrix.length;
			}

			learnNewObject(object){
				var newMatrix = this.matrix;
				
				for(var i=0; i < this.count_prop; i++){
					for(var j=0; j < this.count_object; j++){
						if(j==this.getNameObject(object)){
							newMatrix[i][j] += object.props[i];
						}
						else{
							newMatrix[i][j] -= object.props[i];
						}
					}
				}

				this.matrix = newMatrix;

				if(this.cyber_cube == true){
					this.returnOnBrinkCybercube();
				}
				
			}

			showModel(){
				console.log(this.matrix);
			}

			returnOnBrinkCybercube(){
				for(var i=0; i < this.count_prop; i++){
					for(var j=0; j < this.count_object; j++){
						if(this.matrix[i][j] < -1){
							this.matrix[i][j] = -1;
						}
						else if(this.matrix[i][j] > 1){
							this.matrix[i][j] = 1;
						}
					}
				}
			}

			specifyObject(props){
				var demons = [];

				for(var i = 0; i < this.count_object; i++){
					demons[i]=0;
					for(var j=0; j < this.count_prop; j++){
						demons[i] += props[j]*this.matrix[j][i];
					}
				}
				
				var maxElem = Math.max.apply(null, demons);
				console.log(demons);
				return demons.indexOf(maxElem);

			}
		}

		let model = new ExpertModel(initialModel, true);

		for(var i=0; i < model.count_object; i++){
			model.learnNewObject(objects[i]);
		}

		model.showModel();
		var elem = model.specifyObject(objects[3].props);
		console.log(elem);
		console.log("Свойства ["+objects[elem].props+"] \n Скорее всего это: "+objects[elem].name);
	</script>
</body>
</html>